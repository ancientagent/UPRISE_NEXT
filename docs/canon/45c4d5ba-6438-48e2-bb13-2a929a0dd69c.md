--- Page 1 ---

Note: This document is a verbatim markdown export from the DeepAgent-authored source. It reflects the DeepAgent project state at time of export.

1
ğŸµ
UPRISE_NEXT â€” Getting Started Guide
Welcome to UPRISE! This is your comprehensive entry point for understanding and contributing to
the UPRISE music community platform. Whether youâ€™re a developer, agent, or stakeholder, this guide
will help you get up to speed quickly.
Last Updated: January 10, 2026
Status: âœ… Active
Phase: Phase 1 Complete, Phase 2 In Progress
ğŸ“‹ Table of Contents
1. Project Overview
2. Architecture at a Glance
3. Current State
4. Getting Started
5. Documentation Guide
6. Multi-Agent Workflow
7. Development Workflow
8. Key Constraints & Guardrails
9. Project Structure
10. Quick Reference
1. Project Overview
What is UPRISE?
UPRISE is a modernized music community platform designed to connect musicians, fans, and muâ€
sic enthusiasts through location-based communities, real-time collaboration, and content sharing. Itâ€™s
a complete rebuild of the legacy UPRISE platform with modern architecture, best practices, and
scalability in mind.
What Problem Does It Solve?
UPRISE addresses several key challenges in the music community space:
â€¢ Fragmented Communities: Musicians and fans lack a unified platform to connect based on
location and shared musical interests
â€¢ Discovery Barriers: Finding local music events, communities, and collaborators is difficult
without centralized tools
â€¢ Real-Time Collaboration: Existing platforms donâ€™t support seamless real-time interaction and
content sharing
â€¢ Geographic Context: Music communities are inherently local, requiring robust geospatial capabâ€
ilities

--- Page 2 ---

2
â€¢ Content Management: Musicians need tools to manage, share, and promote their work effectâ€
ively
Who Is It For?
Primary Users:
- Musicians & Artists: Share music, collaborate, and build local followings
- Music Fans: Discover local talent, join communities, and attend events
- Venue Owners & Promoters: Connect with artists and promote events
- Music Communities: Build and manage location-based music scenes
Technical Stakeholders:
- Developers: Building and maintaining the platform
- Agents (AI/LLM): Autonomous contributors following strict architectural patterns
- Product Owners: Defining features and roadmap
- Operations: Maintaining infrastructure and deployments
Vision & Goals
Core Vision:
Create the go-to platform for location-based music communities with seamless discovery, real-time
collaboration, and powerful geospatial features.
Key Goals:
- âœ… Build a scalable, maintainable monorepo architecture
- âœ… Enforce strict separation between web, API, and data tiers
- âœ… Implement robust geospatial features with PostGIS
- âœ… Support real-time collaboration via Socket.IO
- ğŸ”„ Enable rich media management and transcoding
- ğŸ”„ Provide intuitive discovery and recommendation systems
- ğŸ“‹ Support events, promotions, and business features
- ğŸ“‹ Build mobile applications (React Native)
2. Architecture at a Glance
High-Level Architecture
UPRISE_NEXT is built as a Turborepo monorepo with strict tier boundaries. The architecture follows a
multi-service pattern with clear separation of concerns:

--- Page 3 ---

3
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client Layer â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Web Browser â”‚ â”‚ Mobile App (RN) â”‚ â”‚
â”‚ â”‚ (Next.js 15) â”‚ â”‚ (React Native) â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service Layer â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ API (REST) â”‚ â”‚ Socket.IO â”‚ â”‚ Transcoder Worker â”‚ â”‚
â”‚ â”‚ (NestJS) â”‚ â”‚ (Realtime) â”‚ â”‚ (FFmpeg) â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Layer â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ PostgreSQL + PostGIS â”‚ â”‚ S3 / Cloudflare R2 â”‚ â”‚
â”‚ â”‚ (Neon Production) â”‚ â”‚ (Media Storage) â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Key Technologies
Core Stack
â€¢ Monorepo: Turborepo 2.0 with pnpm workspaces
â€¢ Frontend: Next.js 15 (App Router, React Server Components)
â€¢ Backend: NestJS (REST API)
â€¢ Real-time: Socket.IO (authenticated namespaces)
â€¢ Database: PostgreSQL 14+ with PostGIS extension
â€¢ ORM: Prisma (with PostGIS support)
â€¢ Language: TypeScript 5.5+ (strict mode everywhere)
UI & Styling
â€¢ Components: shadcn/ui (Radix UI primitives)
â€¢ Styling: Tailwind CSS
â€¢ Validation: Zod schemas
â€¢ Forms: React Hook Form
Infrastructure
â€¢ Package Manager: pnpm 9.x
â€¢ Node Version: 22.x
â€¢ CI/CD: GitHub Actions
â€¢ Deployment:
â€¢ Web â†’ Vercel
â€¢ API/Socket â†’ Fly.io or AWS App Runner
â€¢ Workers â†’ AWS Fargate
â€¢ Database â†’ Neon (PostGIS enabled)
â€¢ Storage â†’ S3 or Cloudflare R2

--- Page 4 ---

4
Media & Processing
â€¢ Transcoding: FFmpeg pipelines
â€¢ Storage: S3-compatible object storage
â€¢ Formats: Multi-quality, multi-format outputs
Monitoring & Observability
â€¢ Error Tracking: Sentry
â€¢ Analytics: PostHog
â€¢ Logging: Structured JSON logs with context
Service Breakdown
ğŸŒ apps/web (Next.js 15)
Purpose: User-facing web application
Deployment: Vercel
Port: 3000 (development)
Key Features:
- Server-side rendering and static generation
- React Server Components for optimal performance
- NO direct database access (enforced by contract guard)
- API client for all backend communication
- Socket.IO client for real-time features
Boundaries:
- âŒ No @prisma/client imports
- âŒ No direct DB queries
- âŒ No server-only secrets in client code
- âœ… All data via API endpoints
- âœ… Shared types from @uprise/types
ğŸ”Œ apps/api (NestJS)
Purpose: REST API and data tier
Deployment: Fly.io or AWS App Runner
Port: 4000 (development)
Key Features:
- RESTful endpoints with consistent response format
- JWT authentication and authorization
- Zod schema validation
- PostGIS geospatial queries
- Prisma ORM with type safety
- Rate limiting and CORS protection
Responsibilities:
- Database access (single source of truth)
- Business logic and validation
- Authentication and authorization
- Geospatial queries and operations
- Data mutations and aggregations

--- Page 5 ---

5
âš¡ apps/socket (Socket.IO)
Purpose: Real-time communication server
Deployment: Fly.io or AWS App Runner
Port: 4001 (development)
Key Features:
- JWT-authenticated connections
- Dynamic community namespaces ( /community/:id )
- Structured logging with context
- Graceful shutdown and error handling
- Event-driven architecture
Events Supported:
- join-community - User joins a community room
- leave-community - User leaves a community room
- community-message - Chat messages
- track-share - Music track sharing
- presence - User presence tracking
ğŸ¬ apps/workers/transcoder (FFmpeg)
Purpose: Asynchronous media processing
Deployment: AWS Fargate or Fly.io
Port: N/A (worker)
Key Features:
- Multi-format transcoding (MP3, AAC, OGG)
- Multiple quality levels
- Progress tracking via webhooks
- S3/R2 storage integration
- Automatic cleanup and error handling
ğŸ“¦ packages/ (Shared)
â€¢ packages/ui: Shared React components (shadcn/ui based)
â€¢ packages/types: TypeScript types, Zod schemas, OpenAPI generation
â€¢ packages/config: Shared configuration and constants
â€¢ packages/sdk: (Planned) Generated API client from OpenAPI
ğŸ—„ï¸ infra/prisma
Purpose: Database schema and migrations
Location: infra/prisma/
Contents:
- schema.prisma - Prisma schema with PostGIS types
- migrations/ - Version-controlled SQL migrations
- seed.ts - Development seed data

--- Page 6 ---

6
3. Current State
Whatâ€™s Been Completed
âœ… Phase 1: Foundation (COMPLETE)
Status: Certified complete via docs/PHASE1_COMPLETION_REPORT.md
Deliverables:
- âœ… Turborepo monorepo scaffolding
- âœ… Next.js 15 web application ( apps/web )
- âœ… NestJS REST API ( apps/api )
- âœ… Socket.IO real-time server ( apps/socket )
- âœ… FFmpeg transcoder worker ( apps/workers/transcoder )
- âœ… Shared packages ( ui , types , config )
- âœ… PostGIS-ready Prisma schema
- âœ… Environment templates ( .env.example )
- âœ… Documentation framework
- âœ… Operational runbooks
âœ… T1-T4: Core Features (COMPLETE)
T1: Web-Tier Contract Guard âœ…
- Runtime protection against database access in web tier
- Build-time enforcement via TypeScript types
- ESLint rules for prohibited imports
- CI integration (fails on violations)
- Documentation: apps/web/WEB_TIER_BOUNDARY.md
T2: PostGIS Integration âœ…
- Community geofencing with radius-based boundaries
- Nearby community search (ST_DWithin queries)
- Location verification within geofence
- GIST indexes for performance
- Comprehensive coordinate validation
- Health check endpoints
T3: Real-Time Socket.IO âœ…
- JWT authentication middleware
- Dynamic community namespaces
- Structured logging with context
- Join/leave/message events
- Graceful shutdown handling
- Full test coverage
T4: Comprehensive Testing âœ…
- Jest/Vitest configuration for all apps
- Web-tier boundary tests
- API integration tests (PostGIS)
- Socket.IO event tests
- Test coverage reporting

--- Page 7 ---

7
âœ… T5-T8: Infrastructure & CI/CD (COMPLETE)
T5: Infrastructure Policy Check âœ…
- Automated web-tier boundary scanning
- CI integration (GitHub Actions)
- Error codes for violation types
- Verbose and help modes
- Documentation: docs/RUNBOOK.md
T6: PostGIS API Endpoints âœ…
- GET /api/communities/nearby - Find communities by location
- POST /api/communities/:id/verify-location - Verify user location
- GET /api/health/postgis - PostGIS health check
- Raw SQL for geography type handling
- Comprehensive error handling
T7: Documentation Framework âœ…
- Multi-agent documentation strategy
- Spec templates and organization
- Agent handoff templates
- Documentation in docs/specs/ , docs/handoff/
T8: CI/CD Pipeline âœ…
- Main CI pipeline (lint, typecheck, test, build)
- Secrets scanning (Gitleaks, TruffleHog)
- Infrastructure policy checks
- Caching and optimization
- Workflows: .github/workflows/ci.yml , secrets-check.yml , infra-policy-check.yml
Whatâ€™s Working
Development Environment:
- âœ… Local development with pnpm dev
- âœ… Docker Compose for PostgreSQL + PostGIS
- âœ… Hot reload for all services
- âœ… TypeScript strict mode across all workspaces
- âœ… Path aliases ( @uprise/ui , @uprise/types )
Testing Infrastructure:
- âœ… Unit tests (Jest/Vitest)
- âœ… Integration tests (API + PostGIS)
- âœ… Socket tests (authentication + events)
- âœ… Web-tier boundary tests
- âœ… CI-automated test runs
CI/CD:
- âœ… Automated PR checks (lint, typecheck, test, build)
- âœ… Web-tier contract enforcement
- âœ… Secrets scanning
- âœ… Build artifact uploads
- âœ… Test coverage reporting
Database:
- âœ… Prisma schema with PostGIS support

--- Page 8 ---

8
- âœ… Migrations system
- âœ… Seed data for development
- âœ… Type-safe database client
Geospatial Features:
- âœ… Community creation with geofences
- âœ… Nearby community search
- âœ… Location verification
- âœ… Distance calculations
Real-Time Features:
- âœ… JWT-authenticated connections
- âœ… Community namespaces
- âœ… Join/leave events
- âœ… Message broadcasting
Whatâ€™s In Progress
Phase 2 Features:
- ğŸ”„ User authentication system (OAuth, JWT)
- ğŸ”„ User profile management
- ğŸ”„ Community membership and roles
- ğŸ”„ Content management (posts, tracks)
- ğŸ”„ Discovery and recommendation engine
- ğŸ”„ Mobile app (React Native)
Infrastructure:
- ğŸ”„ Production deployments (Vercel, Fly.io, AWS)
- ğŸ”„ Monitoring and observability setup
- ğŸ”„ Error tracking (Sentry)
- ğŸ”„ Analytics (PostHog)
Whatâ€™s Planned
Phase 3+ Features:
- ğŸ“‹ Events system (create, RSVP, check-in)
- ğŸ“‹ Promotions and business features
- ğŸ“‹ Advanced discovery (map-based, filters)
- ğŸ“‹ Messaging and notifications
- ğŸ“‹ Content moderation tools
- ğŸ“‹ Analytics dashboards
- ğŸ“‹ Admin panel
Technical Enhancements:
- ğŸ“‹ E2E tests (Playwright)
- ğŸ“‹ Performance testing (Lighthouse CI)
- ğŸ“‹ Visual regression testing
- ğŸ“‹ Automated dependency updates
- ğŸ“‹ Deploy previews per PR
- ğŸ“‹ OpenAPI client generation ( packages/sdk )

--- Page 9 ---

9
4. Getting Started
Prerequisites
Before you begin, ensure you have the following installed:
Required
â€¢ Node.js: v20.x or later (v22.x recommended)
â€¢ Install via fnm (https://github.com/Schniz/fnm) or nvm (https://github.com/nvm-sh/nvm)
â€¢ pnpm: v9.x or later
â€¢ Install via corepack: corepack enable
â€¢ PostgreSQL: 14+ with PostGIS extension
â€¢ Use Docker (recommended) or install locally
â€¢ Git: For version control
Optional (but recommended)
â€¢ Docker & Docker Compose: For local database and workers
â€¢ FFmpeg: Required for transcoder worker
â€¢ VSCode: Recommended editor with extensions:
â€¢ ESLint
â€¢ Prettier
â€¢ TypeScript
â€¢ Tailwind CSS IntelliSense
Environment Setup
1. Clone the Repository
git clone <repository-url>
cd UPRISE_NEXT
2. Install Dependencies
# Enable corepack (for pnpm)
corepack enable
# Install all dependencies
pnpm install
3. Set Up Environment Variables
# Copy environment templates
cp apps/api/.env.example apps/api/.env
cp apps/socket/.env.example apps/socket/.env
cp apps/web/.env.example apps/web/.env.local
# Edit each .env file with your configuration
# Key variables to set:
# - DATABASE_URL (PostgreSQL connection string)
# - JWT_SECRET (for authentication)
# - NEXT_PUBLIC_API_URL (for web app)
# - NEXT_PUBLIC_SOCKET_URL (for web app)

--- Page 10 ---

10
Example apps/api/.env :
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/uprise?schema=public"
JWT_SECRET="your-super-secret-jwt-key-change-this"
PORT=4000
NODE_ENV=development
Example apps/web/.env.local :
NEXT_PUBLIC_API_URL=http://localhost:4000
NEXT_PUBLIC_SOCKET_URL=http://localhost:4001
4. Start PostgreSQL with PostGIS
Option A: Docker (Recommended)
# Start PostgreSQL + PostGIS
docker-compose up -d
# Verify PostGIS is available
docker exec -it uprise-postgres psql -U postgres -d uprise -c "SELECT Postâ€
GIS_version();"
Option B: Local Installation
# Install PostgreSQL and PostGIS
# Ubuntu/Debian:
sudo apt-get install postgresql-14 postgresql-14-postgis-3
# macOS:
brew install postgresql@14 postgis
# Create database and enable PostGIS
createdb uprise
psql uprise -c "CREATE EXTENSION postgis;"
5. Initialize Database
cd apps/api
# Generate Prisma Client
pnpm prisma generate
# Run migrations
pnpm prisma migrate dev
# (Optional) Seed development data
pnpm prisma db seed

--- Page 11 ---

11
6. Verify Setup
# Run all checks
pnpm run lint # âœ… Should pass
pnpm run typecheck # âœ… Should pass
pnpm run build # âœ… Should build all apps
pnpm run test # âœ… Should run all tests
pnpm run infra-policy-check # âœ… Should pass
Quick Start Commands
Development Mode
# Run all services in development mode
pnpm dev
# Services will be available at:
# - Web: http://localhost:3000
# - API: http://localhost:4000
# - Socket: http://localhost:4001
# - Transcoder: (background worker)
Run Individual Services
# Run specific app
pnpm --filter web dev # Next.js web app
pnpm --filter api dev # NestJS API
pnpm --filter socket dev # Socket.IO server
pnpm --filter transcoder dev # Transcoder worker
# Run multiple specific apps
pnpm --filter web --filter api dev
How to Run Locally
Step-by-Step:
1. Terminal 1 - Database:
bash
docker-compose up
2. Terminal 2 - API:
bash
pnpm --filter api dev
Wait for: ğŸš€ API server running on http://localhost:4000
3. Terminal 3 - Socket:
bash
pnpm --filter socket dev
Wait for: ğŸ”Œ Socket.IO server running on port 4001
4. Terminal 4 - Web:
bash
pnpm --filter web dev
Wait for: âœ“ Ready on http://localhost:3000

--- Page 12 ---

12
5. Test the Setup:
```bash
# Check API health
curl http://localhost:4000/api/health
# Check PostGIS health
curl http://localhost:4000/api/health/postgis
# Open web app
open http://localhost:3000
```
How to Run Tests
All Tests
# Run all tests across all workspaces
pnpm test
# With coverage
pnpm run test -- --coverage
Specific App Tests
# Web app tests
pnpm --filter web test
# API tests (requires database)
DATABASE_URL="postgresql://..." pnpm --filter api test
# Socket tests
pnpm --filter socket test
Watch Mode (for development)
# Watch mode for web
pnpm --filter web test:watch
# Watch mode for API
pnpm --filter api test:watch
Test Coverage
# Generate coverage report
pnpm --filter api test:coverage
# Coverage report will be in apps/api/coverage/

--- Page 13 ---

13
How to Build
Production Build
# Build all apps
pnpm build
# Build outputs:
# - apps/web/.next/
# - apps/api/dist/
# - apps/socket/dist/
# - apps/workers/transcoder/dist/
Build Individual Apps
pnpm --filter web build
pnpm --filter api build
pnpm --filter socket build
Clean Build
# Remove all build artifacts and node_modules
pnpm clean
# Reinstall and rebuild
pnpm install
pnpm build
Troubleshooting Common Issues
Issue: Prisma Client not found
# Solution: Generate Prisma Client
cd apps/api
pnpm prisma generate
Issue: PostGIS extension not available
# Solution: Enable PostGIS in your database
psql uprise -c "CREATE EXTENSION IF NOT EXISTS postgis;"
# Verify
psql uprise -c "SELECT PostGIS_version();"
Issue: Port already in use
# Solution: Kill process on port
# Linux/macOS:
lsof -ti:3000 | xargs kill -9 # For port 3000
lsof -ti:4000 | xargs kill -9 # For port 4000
# Or change port in .env

--- Page 14 ---

14
Issue: Web-tier boundary violations
# Solution: Run policy check to see violations
pnpm run infra-policy-check
# Common fixes:
# - Remove @prisma/client imports from apps/web
# - Use API client instead: import { api } from '@/lib/api'
# - Use NEXT_PUBLIC_ env vars for client-side
Issue: Tests failing due to database
# Solution: Ensure DATABASE_URL is set for tests
DATABASE_URL="postgresql://..." pnpm run test
# Or add to apps/api/.env.test
5. Documentation Guide
Documentation Structure
UPRISE uses a comprehensive, hierarchical documentation system organized by purpose:

--- Page 15 ---

15
docs/
â”œâ”€â”€ RUNBOOK.md # Operational manual (START HERE)
â”œâ”€â”€ PROJECT_STRUCTURE.md # Monorepo layout and conventions
â”œâ”€â”€ GETTING_STARTED.md # This document
â”œâ”€â”€ ENVIRONMENTS.md # Development environment setup
â”œâ”€â”€ CHANGELOG.md # Auto-generated change history
â”œâ”€â”€ FEATURE_DRIFT_GUARDRAILS.md # Zero-drift policy
â”œâ”€â”€ PHASE1_COMPLETION_REPORT.md # Phase 1 milestone
â”œâ”€â”€ STRATEGY_CRITICAL_INFRA_NOTE.md # Infrastructure boundaries
â”‚
â”œâ”€â”€ architecture/ # High-level architecture
â”‚ â””â”€â”€ UPRISE_OVERVIEW.md # System overview
â”‚
â”œâ”€â”€ blueprints/ # Design patterns and workflows
â”‚ â”œâ”€â”€ MULTI_AGENT_DOCUMENTATION_STRATEGY.md
â”‚ â””â”€â”€ README.md
â”‚
â”œâ”€â”€ specs/ # Feature specifications (NEW)
â”‚ â”œâ”€â”€ TEMPLATE.md # Spec template
â”‚ â”œâ”€â”€ README.md # Specs index
â”‚ â”œâ”€â”€ system/ # Cross-cutting specs
â”‚ â”‚ â”œâ”€â”€ web-tier-contract-guard.md (T5)
â”‚ â”‚ â”œâ”€â”€ ci-cd-pipeline.md (T8)
â”‚ â”‚ â”œâ”€â”€ documentation-framework.md (T7)
â”‚ â”‚ â””â”€â”€ agent-handoff-process.md
â”‚ â”œâ”€â”€ communities/ # Community feature specs
â”‚ â””â”€â”€ users/ # User/auth feature specs
â”‚
â”œâ”€â”€ handoff/ # Agent handoff documents
â”‚ â”œâ”€â”€ TEMPLATE_agent-handoff.md
â”‚ â”œâ”€â”€ TEMPLATE_handoff-phase.md
â”‚ â””â”€â”€ handoff-phase-1.md
â”‚
â””â”€â”€ Specifications/ # Legacy specs (canonical IDs)
â”œâ”€â”€ README.md # Legacy spec index
â”œâ”€â”€ 01_UPRISE_Master_Overview.md
â”œâ”€â”€ 02_UPRISE_Skeleton_Framework.md
â”œâ”€â”€ 04_UPRISE_Community_Location_System.md
â””â”€â”€ ... (other legacy specs)

--- Page 16 ---

16
Where to Find What
What You Need Where to Look
Getting Started docs/GETTING_STARTED.md (this doc)
Operational Commands docs/RUNBOOK.md
Project Layout docs/PROJECT_STRUCTURE.md
Environment Setup docs/ENVIRONMENTS.md
Architecture Overview docs/architecture/UPRISE_OVERVIEW.md
Multi-Agent Workflow docs/blueprints/
MULTI_AGENT_DOCUMENTATION_STRATEGY.md
Feature Specs (New) docs/specs/<module>/*.md
Legacy Specs docs/Specifications/*.md
Phase Completion docs/handoff/handoff-phase-<n>.md
Change History docs/CHANGELOG.md
Web-Tier Boundaries apps/web/WEB_TIER_BOUNDARY.md
API Documentation (Generated from Zod schemas)
Infrastructure Policy docs/STRATEGY_CRITICAL_INFRA_NOTE.md
Essential Reading by Role
ğŸ”§ For Developers (First Time)
Start here in order:
1. docs/GETTING_STARTED.md (this document) â€” Overview and quick start
2. docs/RUNBOOK.md â€” Operational manual and commands
3. docs/PROJECT_STRUCTURE.md â€” Monorepo layout and conventions
4. docs/FEATURE_DRIFT_GUARDRAILS.md â€” Zero-drift policy (critical!)
5. apps/web/WEB_TIER_BOUNDARY.md â€” Web-tier contract rules
6. Relevant specs in docs/specs/ for your feature area
Then as needed:
- docs/ENVIRONMENTS.md â€” Environment setup details
- docs/architecture/UPRISE_OVERVIEW.md â€” System architecture
- docs/CHANGELOG.md â€” Recent changes
ğŸ¤– For Agents (AI/LLM Contributors)
Mandatory reading before any task:
1. docs/RUNBOOK.md â€” Agent operations manual
2. docs/STRATEGY_CRITICAL_INFRA_NOTE.md â€” Infrastructure boundaries

--- Page 17 ---

17
3. docs/FEATURE_DRIFT_GUARDRAILS.md â€” Zero-drift policy
4. docs/blueprints/MULTI_AGENT_DOCUMENTATION_STRATEGY.md â€” Multi-agent workflow
For implementation:
5. Relevant specs in docs/specs/ â€” Feature requirements
6. docs/handoff/TEMPLATE_agent-handoff.md â€” Agent handoff template
7. apps/web/WEB_TIER_BOUNDARY.md â€” Web-tier contract (if touching web)
For handoff:
8. docs/handoff/TEMPLATE_handoff-phase.md â€” Phase handoff template
ğŸ“Š For Product Owners / Stakeholders
Start here:
1. docs/GETTING_STARTED.md (this document) â€” Project overview
2. docs/architecture/UPRISE_OVERVIEW.md â€” System architecture
3. docs/PHASE1_COMPLETION_REPORT.md â€” Current status
4. docs/CHANGELOG.md â€” Recent changes
For planning:
5. docs/Specifications/ â€” Legacy feature specs (canonical IDs)
6. docs/specs/ â€” New feature specs (module-organized)
7. docs/handoff/ â€” Phase completion reports
ğŸ” For Reviewers / Maintainers
Essential reading:
1. docs/FEATURE_DRIFT_GUARDRAILS.md â€” Zero-drift policy
2. docs/PROJECT_STRUCTURE.md â€” PR and branch conventions
3. docs/RUNBOOK.md â€” CI/CD and enforcement mechanisms
4. apps/web/WEB_TIER_BOUNDARY.md â€” Web-tier contract
For reviews:
5. Relevant specs in docs/specs/ â€” Verify against requirements
6. docs/CHANGELOG.md â€” Ensure PR updates changelog
Documentation Principles
Key Principles:
1. Single Source of Truth: Specs define requirements; code implements them
2. Spec-First: No feature is implemented without a spec (zero-drift policy)
3. Versioned: All docs in Git; changes tracked via PRs
4. Hierarchical: High-level overviews â†’ detailed specs â†’ implementation notes
5. Traceable: Specs link to PRs; PRs link to specs
6. Up-to-Date: Docs updated in same PR as code changes
6. Multi-Agent Workflow
How the Multi-Agent Documentation Strategy Works
UPRISE uses a structured documentation strategy to enable multiple agents (AI/LLM and human)
to collaborate effectively without fragmenting knowledge or causing regressions.

--- Page 18 ---

18
Core Concepts
1. Documentation Hierarchy
Blueprints (Patterns) â†’ Specs (Requirements) â†’ Handoffs (Outcomes)
â€¢ Blueprints: High-level design patterns and workflows (e.g., multi-agent strategy)
â€¢ Specs: Feature requirements and contracts (organized by module)
â€¢ Handoffs: Agent notes and phase completion reports
2. Strict Boundaries
- Web-tier: No database access, no secrets, no server imports
- API-tier: Single source of truth for data
- Socket-tier: Subscribe-only real-time events
- Worker-tier: Asynchronous processing
3. Zero-Drift Policy
- No feature implemented without a spec
- No spec changes without human approval
- No architectural violations (enforced by CI)
Workflow Phases
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ONBOARDING â”‚
â”‚ Agent reads: RUNBOOK, STRATEGY NOTE, GUARDRAILS, SPECS â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. PLANNING â”‚
â”‚ Agent creates/extends spec under docs/specs/ â”‚
â”‚ Follows TEMPLATE.md structure â”‚
â”‚ Gets approval if new behavior â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. IMPLEMENTATION â”‚
â”‚ Agent implements per spec requirements â”‚
â”‚ Creates agent handoff doc (docs/handoff/agent-<name>-<task>.md)â”‚
â”‚ Records decisions, challenges, lessons â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. VALIDATION â”‚
â”‚ CI enforces boundaries (web-tier, secrets, etc.) â”‚
â”‚ Tests validate behavior â”‚
â”‚ PR links to specs and includes deployment target â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. HANDOFF â”‚
â”‚ Agent updates agent handoff document â”‚
â”‚ At phase end, compile handoff-phase-<n>.md â”‚
â”‚ Document outcomes, issues, next steps â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

--- Page 19 ---

19
How to Onboard as a New Agent
Step 1: Read Mandatory Documents
In this exact order:
1. docs/RUNBOOK.md
- Agent operations manual
- Commands and CI rules
- Enforcement mechanisms
2. docs/STRATEGY_CRITICAL_INFRA_NOTE.md
- DeepAgent vs. production infrastructure
- What you can/cannot deploy
- Target platforms
3. docs/FEATURE_DRIFT_GUARDRAILS.md
- Zero-drift policy
- Spec-first requirements
- Whatâ€™s allowed without specs
4. docs/blueprints/MULTI_AGENT_DOCUMENTATION_STRATEGY.md
- Multi-agent workflow
- Documentation hierarchy
- Handoff process
5. docs/PROJECT_STRUCTURE.md
- Monorepo layout
- Package conventions
- PR requirements
Step 2: Understand Your Task
â€¢ Read the spec: Find relevant spec in docs/specs/<module>/
â€¢ Check legacy specs: If spec references canonical IDs, read docs/Specifications/
â€¢ Review recent handoffs: Read docs/handoff/handoff-phase-<n>.md for context
Step 3: Validate Boundaries
â€¢ Web-tier: Read apps/web/WEB_TIER_BOUNDARY.md if touching web
â€¢ Database: Ensure youâ€™re in apps/api for data access
â€¢ Secrets: Verify no hardcoded secrets in code
Step 4: Set Up Locally
â€¢ Follow Section 4: Getting Started of this document
â€¢ Run all checks: pnpm run lint && pnpm run typecheck && pnpm run test
â€¢ Run infra policy check: pnpm run infra-policy-check

--- Page 20 ---

20
Step 5: Create Agent Handoff Document
# Copy template
cp docs/handoff/TEMPLATE_agent-handoff.md docs/handoff/agent-<your-name>-<task>.md
# Fill in sections:
# - Scope and deliverables
# - Decisions made
# - Challenges and lessons
# - Outstanding questions
# - Recommendations
How to Create Handoff Documents
Agent Handoff Document (Per Task)
Purpose: Document your implementation decisions, challenges, and recommendations.
Template: docs/handoff/TEMPLATE_agent-handoff.md
Structure:
# Agent Handoff: <Agent Name> â€” <Task>
**Agent:** <Your name/identifier>
**Task:** <Brief task description>
**Status:** [In Progress | Complete | Blocked]
**Date:** <YYYY-MM-DD>
## Scope and Deliverables
- What was in scope
- What was out of scope
- What was delivered
## Decisions Made
- Key architectural decisions
- Why alternative approaches were rejected
## Challenges and Lessons
- What was difficult
- How it was solved
- What would you do differently
## Outstanding Questions
- Unresolved questions
- Areas needing human decision
## Recommendations
- Next steps
- Technical debt identified
- Improvements suggested
## References
- Specs: docs/specs/...
- PRs: #123, #456
- Related docs: ...
When to Create:
- At start of implementation (with initial scope)

--- Page 21 ---

21
- During implementation (update as you go)
- At completion (final state, recommendations)
Phase Handoff Document (Per Phase)
Purpose: Compile all agent handoffs and outcomes for a phase.
Template: docs/handoff/TEMPLATE_handoff-phase.md
Structure:
# Handoff Report â€” Phase <N>
**Phase:** <N>
**Status:** [In Progress | Complete]
**Date Range:** <Start> to <End>
## Outcomes
- High-level summary of what was accomplished
## Completed Tasks
| Area | Status | Notes | Links |
|------|--------|-------|-------|
| Task 1 | âœ… | Brief notes | PR #123 |
| Task 2 | ğŸ”„ | In progress | Spec T5 |
## Agent Documents Included
- agent-alice-auth.md
- agent-bob-postgis.md
## PRs / Commits
- #123: Implemented auth flow
- #456: Added PostGIS endpoints
## Known Issues / Technical Debt
- Issue 1: Description and tracking link
- Issue 2: Description and tracking link
## Next Steps
- Phase N+1 priorities
- Recommended approach
## Validation
- Commands to verify baseline health
- Smoke tests to run
When to Create:
- At end of each phase (e.g., Phase 1, Phase 2)
- Compiled from individual agent handoffs
- Includes outcomes, issues, next steps
How to Create Specs
Step 1: Choose Location
â€¢ New module: Create docs/specs/<module-name>/
â€¢ Existing module: Add to docs/specs/<module-name>/
â€¢ Cross-cutting: Use docs/specs/system/

--- Page 22 ---

22
Step 2: Copy Template
cp docs/specs/TEMPLATE.md docs/specs/<module>/<feature-name>.md
Step 3: Fill in Sections
Minimum sections required:
- ID: Unique identifier (e.g., T5 , C1 , U2 )
- Status: draft , active , deprecated
- Owner: Team or module (e.g., platform , communities )
- Overview & Purpose: What and why
- Use Cases: Who uses this and how
- Functional Requirements: What it must do
- Non-Functional Requirements: Performance, security, etc.
- Architectural Boundaries: What it must NOT do
- Data Models & Migrations: Prisma schema changes
- API Design: Endpoints, DTOs, validation
- Web UI / Client Behavior: Frontend integration
- Acceptance Tests: How to validate it works
- Success Metrics: How to measure success
- References: Links to related docs, PRs
Step 4: Link Legacy Specs (If Applicable)
If your spec relates to legacy canonical IDs:
- Reference them in â€œReferencesâ€ section
- Update docs/Specifications/README.md to cross-link
Step 5: Get Approval
â€¢ If spec introduces new behavior: Human approval required
â€¢ If spec documents existing behavior: Proceed to implement
â€¢ If spec changes architectural boundaries: Stop and ask
Step 6: Link in PRs
All PRs must include:
Deployment Target: [Vercel|Fly|AppRunner|Fargate|Neon]
Phase: [1|2|3]
Specs: docs/specs/system/web-tier-contract-guard.md (T5)
7. Development Workflow
Branching Strategy
UPRISE uses a trunk-based development strategy with feature branches:

--- Page 23 ---

23
Branch Types
Branch Type Naming Purpose Example
Main main Production-ready main
code
Development develop Integration branch develop
Feature feat/<scope> New features feat/community-
search
Bugfix fix/<scope> Bug fixes fix/postgis-query
Chore chore/<scope> Maintenance chore/update-deps
Docs docs/<scope> Documentation docs/update-runbook
Hotfix hotfix/<scope> Emergency fixes hotfix/auth-vulnerâ€
ability
Branch Workflow
main (production)
â”‚
â”œâ”€ develop (integration)
â”‚ â”‚
â”‚ â”œâ”€ feat/community-search
â”‚ â”œâ”€ feat/user-profiles
â”‚ â”œâ”€ fix/postgis-query
â”‚ â””â”€ chore/update-deps
â”‚
â””â”€ hotfix/critical-bug (emergency only)
Creating a Branch
# Update from main
git checkout main
git pull origin main
# Create feature branch
git checkout -b feat/your-feature-name
# Push branch
git push -u origin feat/your-feature-name
PR Requirements
Every pull request MUST include the following information:

--- Page 24 ---

24
PR Description Template
## Description
Brief description of the changes.
## Deployment Target
[Vercel|Fly|AppRunner|Fargate|Neon]
## Phase
[1|2|3]
## Specs
- docs/specs/system/web-tier-contract-guard.md (T5)
- docs/specs/communities/community-search.md (C3)
## Changes
- [ ] Feature implementation
- [ ] Tests added/updated
- [ ] Documentation updated
- [ ] CHANGELOG.md updated
## Breaking Changes
- None / List breaking changes
## Testing
- [ ] Local tests passing (`pnpm run test`)
- [ ] Typecheck passing (`pnpm run typecheck`)
- [ ] Lint passing (`pnpm run lint`)
- [ ] Build successful (`pnpm run build`)
- [ ] Infra policy check passing (`pnpm run infra-policy-check`)
## Screenshots / Videos
(If applicable)
## Related Issues
Closes #123
Related to #456
PR Checklist
Before submitting a PR, ensure:
â€¢ [ ] Spec exists for new behavior (zero-drift policy)
â€¢ [ ] Branch is up-to-date with target branch
â€¢ [ ] All tests pass locally
â€¢ [ ] Typecheck passes ( pnpm run typecheck )
â€¢ [ ] Lint passes ( pnpm run lint )
â€¢ [ ] Build succeeds ( pnpm run build )
â€¢ [ ] Infra policy check passes ( pnpm run infra-policy-check )
â€¢ [ ] CHANGELOG.md updated with your changes
â€¢ [ ] Documentation updated (if applicable)
â€¢ [ ] No hardcoded secrets or sensitive data
â€¢ [ ] No web-tier boundary violations
â€¢ [ ] PR description includes deployment target, phase, and specs

--- Page 25 ---

25
CI/CD Pipeline
CI Triggers
CI runs automatically on:
- Pull requests to main or develop
- Pushes to main or develop
- Manual workflow dispatch
CI Jobs
1. Install Dependencies
- Installs pnpm packages
- Caches dependencies for speed
2. Lint
- Runs ESLint across all workspaces
- Enforces code style and patterns
- Command: pnpm run lint
3. Type Check
- Runs TypeScript compiler
- Validates type safety across all apps
- Command: pnpm run typecheck
4. Test (Matrix)
- Runs tests for each app in parallel
- Matrix: [web, api, socket]
- Command: pnpm --filter <app> test
5. Build (Matrix)
- Builds each app in parallel
- Validates production builds
- Matrix: [web, api, socket, transcoder]
- Command: pnpm --filter <app> build
6. Infrastructure Policy
- Enforces web-tier contract boundaries
- Scans for prohibited patterns
- Command: pnpm run infra-policy-check
7. CI Success
- Final validation that all checks passed
- Aggregates status from all jobs
Secrets Scanning
Separate workflow ( secrets-check.yml ):
- Runs on PR, push, and weekly schedule
- Uses Gitleaks and TruffleHog
- Custom patterns for UPRISE-specific secrets
- Scans full git history
- Validates .env.example files
Prohibited secrets:
- AWS access keys

--- Page 26 ---

26
- API keys and tokens
- Private keys (PEM, SSH)
- Database URLs with credentials
- JWT secrets (non-example)
- Stripe live keys
- GitHub tokens
- Sentry DSN
CI Performance
â€¢ Average runtime: 8-12 minutes
â€¢ Cache hit rate: ~95%
â€¢ Test execution: 2-3 minutes (parallelized)
â€¢ Build time: 3-4 minutes
CI Failure Handling
If CI fails:
1. Check the failing job in GitHub Actions
2. Review the error logs
3. Fix locally and verify:
bash
pnpm run lint
pnpm run typecheck
pnpm run test
pnpm run build
pnpm run infra-policy-check
4. Commit and push the fix
5. CI will re-run automatically
Common failures and solutions:
- Lint failure: Run pnpm run lint:fix
- Type error: Fix TypeScript errors in your code
- Test failure: Debug with pnpm --filter <app> test --verbose
- Build failure: Check for missing dependencies or build errors
- Infra policy failure: Remove prohibited imports, use API client
- Secrets detected: Remove secret, use env vars, rotate if committed
Testing Requirements
Test Coverage Requirements
App Minimum Coverage Current Coverage
apps/web 70% âœ… 75%
apps/api 80% âœ… 85%
apps/socket 75% âœ… 80%
apps/workers/transcoder 60% ğŸ”„ Planned

--- Page 27 ---

27
Test Types Required
Unit Tests (Required for all new code)
- Test individual functions and components
- Mock external dependencies
- Fast execution (< 1 second per test)
Integration Tests (Required for API and data layer)
- Test interactions between modules
- Use real database (ephemeral)
- Test PostGIS queries with actual data
E2E Tests (Planned for Phase 2)
- Test user flows in browser
- Use Playwright
- Run nightly + on release
Testing Best Practices
1. Test Structure (AAA Pattern)
describe('FeatureName', () => {
it('should do something when condition', () => {
// Arrange: Set up test data and dependencies
const input = { ... };
// Act: Execute the code under test
const result = functionUnderTest(input);
// Assert: Verify the expected outcome
expect(result).toBe(expectedValue);
});
});
2. Test Isolation
- Each test should be independent
- Use beforeEach for setup
- Use afterEach for cleanup
- Donâ€™t rely on test execution order
3. Test Data
- Use factories or builders
- Avoid hardcoded values
- Use realistic data
4. Mocking
- Mock external dependencies (API calls, database)
- Donâ€™t mock the code under test
- Verify mock calls when appropriate
Code Quality Standards
TypeScript Standards
â€¢ Strict mode: Enabled everywhere
â€¢ No any : Use proper types or unknown

--- Page 28 ---

28
â€¢ Explicit return types: Required for functions
â€¢ No unused variables: Enforced by ESLint
â€¢ Consistent imports: Use path aliases ( @uprise/ui )
Formatting Standards
â€¢ Prettier: Auto-format on save (VSCode)
â€¢ Line length: 100 characters
â€¢ Indentation: 2 spaces
â€¢ Quotes: Single quotes for TypeScript, double for JSX
â€¢ Semicolons: Required
â€¢ Trailing commas: Required for multi-line
ESLint Rules
â€¢ no-restricted-imports : Blocks prohibited modules
â€¢ @typescript-eslint/no-unused-vars : No unused variables
â€¢ @typescript-eslint/explicit-function-return-type : Explicit return types
â€¢ Custom rules: Web-tier boundary enforcement
Naming Conventions
Type Convention Example
Files kebab-case user-service.ts ,
community-dto.ts
Components PascalCase UserProfile.tsx ,
CommunityCard.tsx
Functions camelCase fetchUser() , validateComâ€
munity()
Variables camelCase userId , communityData
Constants UPPER_SNAKE_CASE API_BASE_URL , MAX_RADIUS
Types/Interfaces PascalCase User , CommunityDto
Enums PascalCase UserRole , CommunityStatus
Code Review Standards
â€¢ Approval required: At least 1 reviewer
â€¢ CI must pass: Green checkmarks required
â€¢ No merge conflicts: Must be up-to-date
â€¢ Squash commits: Keep history clean
â€¢ Descriptive commit messages: Follow conventional commits

--- Page 29 ---

29
8. Key Constraints & Guardrails
Feature Drift Policy (Zero Tolerance)
CRITICAL RULE: No feature is implemented without an explicit, approved specification.
What is Feature Drift?
Feature drift is any change that introduces new behavior, new surface area, or new contracts not
explicitly documented and agreed upon.
Examples of feature drift:
- âŒ Adding a new API endpoint not described in a spec
- âŒ Introducing a new database model/migration without a spec update
- âŒ Implementing UI flows that imply new backend behavior without a corresponding contract
- âŒ Bypassing architectural boundaries (e.g., web tier importing server/data modules)
Whatâ€™s Allowed (Without New Specs)
âœ… Bugfixes: Fix build failures, type errors, CI breakages
âœ… Bugfixes: Fix bugs in already-documented behavior
âœ… Refactors: Refactors that donâ€™t change external behavior (same inputs/outputs)
âœ… Documentation: Documentation improvements and link hygiene
Whatâ€™s NOT Allowed (Without Spec Update + Approval)
âŒ New features: Features, flows, or modules â€œfrom imaginationâ€
âŒ New endpoints: API endpoints, DB models, or migrations outside documented requirements
âŒ New semantics: Auth/roles/permissions semantics without an approved spec
âŒ Boundary violations: Web-tier violations (DB access, secrets, server-only imports)
Enforcement
1. Pre-Code Checklist
Before writing any code, verify:
- [ ] I can point to the spec that authorizes this work ( docs/specs/... )
- [ ] Web-tier boundary is respected ( apps/web/WEB_TIER_BOUNDARY.md )
- [ ] Any shared contract changes are reflected in packages/types
- [ ] PR description will include: Deployment Target, Phase, Specs links
2. CI Enforcement
CI will block PRs that:
- Violate web-tier boundaries (T5 guard)
- Contain secrets (secrets scanning)
- Fail tests or builds
3. Review Enforcement
Reviewers will reject PRs that:
- Donâ€™t link to a spec
- Introduce behavior not in the spec
- Violate architectural boundaries
What to Do If Unsure
If itâ€™s unclear whether something is â€œnew behaviorâ€:
1. Treat it as drift and STOP
2. Ask for human clarification

--- Page 30 ---

30
3. Create/extend a spec if needed
4. Get approval before proceeding
Web-Tier Boundary (CRITICAL)
RULE: The web tier ( apps/web ) must NEVER access the database, server-only modules, or secrets dirâ€
ectly.
Prohibited in Web Tier
Database Access:
- âŒ import { PrismaClient } from '@prisma/client'
- âŒ import pg from 'pg'
- âŒ import mongodb from 'mongodb'
- âŒ Any database driver or ORM client
Server Imports:
- âŒ import { UserService } from '../../../api/src/users/user.service'
- âŒ import { anything } from 'apps/api/src/*'
- âŒ import { anything } from 'apps/socket/src/*'
Secrets:
- âŒ process.env.DATABASE_URL
- âŒ process.env.JWT_SECRET
- âŒ process.env.AWS_SECRET_ACCESS_KEY
- âŒ Any non- NEXT_PUBLIC_ environment variable in client components
Server-Only Modules:
- âŒ import { aws-sdk } from 'aws-sdk'
- âŒ import { fs } from 'fs'
- âŒ import { child_process } from 'child_process'
Allowed in Web Tier
API Client:
âœ… import { api } from '@/lib/api'
âœ… const users = await api.get('/users')
Socket.IO Client:
âœ… import { io } from 'socket.io-client'
âœ… const socket = io(SOCKET_URL)
Shared Packages:
âœ… import { Button } from '@uprise/ui'
âœ… import { UserDto } from '@uprise/types'
Public Environment Variables:
âœ… process.env.NEXT_PUBLIC_API_URL
âœ… process.env.NEXT_PUBLIC_SOCKET_URL
Enforcement
1. Runtime Guards
- File: apps/web/src/lib/web-tier-guard.ts
- Functions: assertNotWebTier() , guardPrismaClient() , guardDatabaseAccess()
- Throws errors if prohibited code executes

--- Page 31 ---

31
2. Build-Time Guards
- TypeScript types mark Prisma Client as never in web tier
- ESLint rules block database import patterns
3. CI Guards
- Script: scripts/infra-policy-check.ts
- Scans all files in apps/web
- Detects prohibited patterns
- Fails CI if violations found
Example: Correct vs. Incorrect
âŒ INCORRECT:
// apps/web/src/app/users/page.tsx
import { PrismaClient } from '@prisma/client';
export default async function UsersPage() {
const prisma = new PrismaClient();
const users = await prisma.user.findMany();
return <div>{users.map(u => u.name)}</div>;
}
âœ… CORRECT:
// apps/web/src/app/users/page.tsx
import { api } from '@/lib/api';
export default async function UsersPage() {
const users = await api.get('/users');
return <div>{users.map(u => u.name)}</div>;
}

--- Page 32 ---

32
Architectural Boundaries
Tier Separation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WEB TIER (apps/web) â”‚
â”‚ - Next.js 15 (App Router) â”‚
â”‚ - Client components + Server components â”‚
â”‚ - NO database access â”‚
â”‚ - NO secrets â”‚
â”‚ - Uses: API client, Socket client, Shared packages â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERVICE TIER â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ API (apps/api) â”‚ â”‚ Socket (apps/ â”‚ â”‚
â”‚ â”‚ - REST endpointsâ”‚ â”‚ socket) â”‚ â”‚
â”‚ â”‚ - Auth & authz â”‚ â”‚ - Realtime â”‚ â”‚
â”‚ â”‚ - Validation â”‚ â”‚ - Namespaces â”‚ â”‚
â”‚ â”‚ - Business logicâ”‚ â”‚ - Events â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Prisma Client
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATA TIER â”‚
â”‚ - PostgreSQL + PostGIS â”‚
â”‚ - Prisma schema â”‚
â”‚ - Migrations â”‚
â”‚ - Seeds â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Module Boundaries
Shared Packages ( packages/* ):
- Purpose: Code shared across multiple apps
- Allowed: Types, UI components, utilities, config
- Not Allowed: Business logic, database access, secrets
API ( apps/api ):
- Purpose: Data tier and business logic
- Allowed: Database access, Prisma, business logic, validation
- Not Allowed: Frontend components, browser APIs
Web ( apps/web ):
- Purpose: User-facing application
- Allowed: UI components, API client, Socket client
- Not Allowed: Database access, server-only imports, secrets
Socket ( apps/socket ):
- Purpose: Real-time communication
- Allowed: Socket.IO namespaces, JWT auth, event broadcasting
- Not Allowed: Heavy business logic (delegate to API)

--- Page 33 ---

33
What NOT to Do
ğŸš« DO NOT:
1. Bypass architectural boundaries
- Donâ€™t import database clients in web tier
- Donâ€™t import API source code in web tier
- Donâ€™t hardcode business logic in web tier
2. Commit secrets or sensitive data
- Donâ€™t commit .env files
- Donâ€™t commit API keys, tokens, or credentials
- Donâ€™t commit database URLs with passwords
3. Implement features without specs
- Donâ€™t add â€œnice-to-haveâ€ features on your own
- Donâ€™t extend scope beyond the spec
- Donâ€™t make architectural changes without approval
4. Ignore CI failures
- Donâ€™t force-push to bypass CI
- Donâ€™t merge PRs with failing tests
- Donâ€™t disable ESLint rules to â€œfixâ€ violations
5. Deploy to production from DeepAgent
- Donâ€™t run production services locally
- Donâ€™t configure production databases in DeepAgent
- Donâ€™t deploy to production infrastructure
6. Modify infrastructure without approval
- Donâ€™t change deployment targets
- Donâ€™t modify CI/CD workflows without review
- Donâ€™t alter security policies
7. Break web-tier contract
- Donâ€™t use @prisma/client in apps/web
- Donâ€™t access non- NEXT_PUBLIC_ env vars in client components
- Donâ€™t import from apps/api/src in apps/web
8. Violate zero-drift policy
- Donâ€™t add features without specs
- Donâ€™t change contracts without updating specs
- Donâ€™t implement â€œcreative interpretationsâ€ of specs

--- Page 34 ---

34
9. Project Structure
Directory Layout

--- Page 35 ---

35
UPRISE_NEXT/
â”œâ”€â”€ .github/
â”‚ â”œâ”€â”€ workflows/
â”‚ â”‚ â”œâ”€â”€ ci.yml # Main CI pipeline
â”‚ â”‚ â”œâ”€â”€ secrets-check.yml # Secrets scanning
â”‚ â”‚ â””â”€â”€ infra-policy-check.yml # Web-tier boundary checks
â”‚ â””â”€â”€ ISSUE_TEMPLATE/ # Issue templates
â”‚
â”œâ”€â”€ apps/
â”‚ â”œâ”€â”€ web/ # Next.js 15 web app
â”‚ â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”‚ â”œâ”€â”€ app/ # App Router pages
â”‚ â”‚ â”‚ â”œâ”€â”€ components/ # React components
â”‚ â”‚ â”‚ â”œâ”€â”€ lib/ # Utilities
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ api.ts # API client
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ socket.ts # Socket.IO client
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ web-tier-guard.ts # Runtime guards
â”‚ â”‚ â”‚ â””â”€â”€ styles/ # Global styles
â”‚ â”‚ â”œâ”€â”€ __tests__/ # Web tests
â”‚ â”‚ â”œâ”€â”€ public/ # Static assets
â”‚ â”‚ â”œâ”€â”€ WEB_TIER_BOUNDARY.md # Web-tier contract
â”‚ â”‚ â”œâ”€â”€ .env.example # Environment template
â”‚ â”‚ â””â”€â”€ package.json
â”‚ â”‚
â”‚ â”œâ”€â”€ api/ # NestJS REST API
â”‚ â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”‚ â”œâ”€â”€ modules/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ communities/ # Community endpoints
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ users/ # User endpoints (planned)
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ health/ # Health checks
â”‚ â”‚ â”‚ â”œâ”€â”€ common/ # Shared API code
â”‚ â”‚ â”‚ â””â”€â”€ main.ts # API entry point
â”‚ â”‚ â”œâ”€â”€ test/ # API integration tests
â”‚ â”‚ â”œâ”€â”€ .env.example # Environment template
â”‚ â”‚ â””â”€â”€ package.json
â”‚ â”‚
â”‚ â”œâ”€â”€ socket/ # Socket.IO server
â”‚ â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”‚ â”œâ”€â”€ namespaces/
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ community.namespace.ts # Community rooms
â”‚ â”‚ â”‚ â”œâ”€â”€ middleware/ # Socket middleware
â”‚ â”‚ â”‚ â”œâ”€â”€ logger.ts # Structured logging
â”‚ â”‚ â”‚ â””â”€â”€ main.ts # Socket entry point
â”‚ â”‚ â”œâ”€â”€ test/ # Socket tests
â”‚ â”‚ â”œâ”€â”€ .env.example # Environment template
â”‚ â”‚ â””â”€â”€ package.json
â”‚ â”‚
â”‚ â””â”€â”€ workers/
â”‚ â””â”€â”€ transcoder/ # FFmpeg worker
â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”œâ”€â”€ transcoder.ts # Transcoding logic
â”‚ â”‚ â””â”€â”€ main.ts # Worker entry point
â”‚ â””â”€â”€ package.json
â”‚
â”œâ”€â”€ packages/
â”‚ â”œâ”€â”€ ui/ # Shared UI components
â”‚ â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”‚ â”œâ”€â”€ components/ # shadcn/ui components
â”‚ â”‚ â”‚ â”œâ”€â”€ hooks/ # Custom React hooks
â”‚ â”‚ â”‚ â””â”€â”€ utils/ # UI utilities
â”‚ â”‚ â””â”€â”€ package.json
â”‚ â”‚

--- Page 36 ---

36
â”‚ â”œâ”€â”€ types/ # Shared TypeScript types
â”‚ â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”‚ â”œâ”€â”€ schemas/ # Zod schemas
â”‚ â”‚ â”‚ â”œâ”€â”€ dtos/ # Data transfer objects
â”‚ â”‚ â”‚ â””â”€â”€ index.ts # Type exports
â”‚ â”‚ â””â”€â”€ package.json
â”‚ â”‚
â”‚ â””â”€â”€ config/ # Shared configuration
â”‚ â”œâ”€â”€ src/
â”‚ â”‚ â”œâ”€â”€ constants.ts # App constants
â”‚ â”‚ â””â”€â”€ env.ts # Env validation
â”‚ â””â”€â”€ package.json
â”‚
â”œâ”€â”€ infra/
â”‚ â””â”€â”€ prisma/ # Database schema & migrations
â”‚ â”œâ”€â”€ schema.prisma # Prisma schema (PostGIS)
â”‚ â”œâ”€â”€ migrations/ # SQL migrations
â”‚ â””â”€â”€ seed.ts # Seed data
â”‚
â”œâ”€â”€ scripts/
â”‚ â”œâ”€â”€ infra-policy-check.ts # Web-tier boundary scanner
â”‚ â””â”€â”€ (other utility scripts)
â”‚
â”œâ”€â”€ docs/
â”‚ â”œâ”€â”€ architecture/
â”‚ â”‚ â””â”€â”€ UPRISE_OVERVIEW.md # System architecture
â”‚ â”œâ”€â”€ blueprints/
â”‚ â”‚ â”œâ”€â”€ MULTI_AGENT_DOCUMENTATION_STRATEGY.md
â”‚ â”‚ â””â”€â”€ README.md
â”‚ â”œâ”€â”€ specs/
â”‚ â”‚ â”œâ”€â”€ system/ # Cross-cutting specs
â”‚ â”‚ â”œâ”€â”€ communities/ # Community specs
â”‚ â”‚ â”œâ”€â”€ users/ # User specs
â”‚ â”‚ â”œâ”€â”€ TEMPLATE.md # Spec template
â”‚ â”‚ â””â”€â”€ README.md
â”‚ â”œâ”€â”€ handoff/
â”‚ â”‚ â”œâ”€â”€ TEMPLATE_agent-handoff.md
â”‚ â”‚ â”œâ”€â”€ TEMPLATE_handoff-phase.md
â”‚ â”‚ â””â”€â”€ handoff-phase-1.md
â”‚ â”œâ”€â”€ Specifications/ # Legacy specs
â”‚ â”‚ â””â”€â”€ (canonical IDs referenced elsewhere)
â”‚ â”œâ”€â”€ GETTING_STARTED.md # This document
â”‚ â”œâ”€â”€ RUNBOOK.md # Operational manual
â”‚ â”œâ”€â”€ PROJECT_STRUCTURE.md # Monorepo conventions
â”‚ â”œâ”€â”€ ENVIRONMENTS.md # Dev environment setup
â”‚ â”œâ”€â”€ CHANGELOG.md # Change history
â”‚ â”œâ”€â”€ FEATURE_DRIFT_GUARDRAILS.md # Zero-drift policy
â”‚ â”œâ”€â”€ PHASE1_COMPLETION_REPORT.md # Phase 1 milestone
â”‚ â””â”€â”€ STRATEGY_CRITICAL_INFRA_NOTE.md # Infrastructure boundaries
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ .eslintrc.json
â”œâ”€â”€ turbo.json # Turborepo configuration
â”œâ”€â”€ package.json # Root package.json
â”œâ”€â”€ pnpm-workspace.yaml # pnpm workspace config
â”œâ”€â”€ tsconfig.base.json # Base TypeScript config
â”œâ”€â”€ docker-compose.yml # Local PostgreSQL + PostGIS
â””â”€â”€ README.md # Project README

--- Page 37 ---

37
Where to Find Code for Each Service
Web Application ( apps/web )
â€¢ Pages: apps/web/src/app/
â€¢ Components: apps/web/src/components/
â€¢ API Client: apps/web/src/lib/api.ts
â€¢ Socket Client: apps/web/src/lib/socket.ts
â€¢ Styles: apps/web/src/styles/
â€¢ Tests: apps/web/__tests__/
API Service ( apps/api )
â€¢ Endpoints: apps/api/src/modules/<module>/
â€¢ DTOs: apps/api/src/modules/<module>/dto/
â€¢ Services: apps/api/src/modules/<module>/<module>.service.ts
â€¢ Controllers: apps/api/src/modules/<module>/<module>.controller.ts
â€¢ Tests: apps/api/test/
Socket Service ( apps/socket )
â€¢ Namespaces: apps/socket/src/namespaces/
â€¢ Middleware: apps/socket/src/middleware/
â€¢ Logger: apps/socket/src/logger.ts
â€¢ Tests: apps/socket/test/
Transcoder Worker ( apps/workers/transcoder )
â€¢ Transcoding logic: apps/workers/transcoder/src/transcoder.ts
â€¢ Worker entry: apps/workers/transcoder/src/main.ts
Where to Find Documentation
Operational:
- docs/RUNBOOK.md â€” Commands, CI, operations
- docs/ENVIRONMENTS.md â€” Dev environment setup
- docs/PROJECT_STRUCTURE.md â€” Monorepo conventions
Architecture:
- docs/architecture/UPRISE_OVERVIEW.md â€” System overview
- docs/STRATEGY_CRITICAL_INFRA_NOTE.md â€” Infrastructure boundaries
- apps/web/WEB_TIER_BOUNDARY.md â€” Web-tier contract
Features:
- docs/specs/ â€” Feature specifications (module-organized)
- docs/Specifications/ â€” Legacy specs (canonical IDs)
Process:
- docs/blueprints/MULTI_AGENT_DOCUMENTATION_STRATEGY.md
- docs/FEATURE_DRIFT_GUARDRAILS.md
Status:
- docs/CHANGELOG.md â€” Change history
- docs/handoff/ â€” Agent handoffs and phase reports

--- Page 38 ---

38
Where to Find Tests
Unit Tests
â€¢ Web: apps/web/__tests__/
â€¢ API: apps/api/test/
â€¢ Socket: apps/socket/test/
Integration Tests
â€¢ API: apps/api/test/ (with real database)
â€¢ Socket: apps/socket/test/ (with real connections)
E2E Tests (Planned)
â€¢ Web: apps/web/e2e/ (Playwright)
10. Quick Reference
Common Commands
Development
# Install dependencies
pnpm install
# Run all services
pnpm dev
# Run specific service
pnpm --filter web dev
pnpm --filter api dev
pnpm --filter socket dev
# Run database
docker-compose up -d
Testing
# Run all tests
pnpm test
# Run tests for specific app
pnpm --filter web test
pnpm --filter api test
pnpm --filter socket test
# Watch mode
pnpm --filter web test:watch
# Coverage
pnpm --filter api test:coverage

--- Page 39 ---

39
Code Quality
# Lint
pnpm run lint
pnpm run lint:fix
# Type check
pnpm run typecheck
# Format
pnpm run format
# Infrastructure policy check
pnpm run infra-policy-check
Building
# Build all
pnpm build
# Build specific app
pnpm --filter web build
# Clean build
pnpm clean
pnpm install
pnpm build
Database
# Generate Prisma Client
cd apps/api
pnpm prisma generate
# Run migrations (dev)
pnpm prisma migrate dev
# Run migrations (production)
pnpm prisma migrate deploy
# Seed database
pnpm prisma db seed
# Open Prisma Studio
pnpm prisma studio
Important Links
Documentation
â€¢ Getting Started:docs/GETTING_STARTED.md (./GETTING_STARTED.md)
â€¢ Runbook:docs/RUNBOOK.md (./RUNBOOK.md)
â€¢ Project Structure:docs/PROJECT_STRUCTURE.md (./PROJECT_STRUCTURE.md)
â€¢ Feature Drift Guardrails:docs/FEATURE_DRIFT_GUARDRAILS.md (./FEAâ€
TURE_DRIFT_GUARDRAILS.md)
â€¢ Web-Tier Boundary:apps/web/WEB_TIER_BOUNDARY.md (../apps/web/WEB_TIER_BOUNDARY.md)

--- Page 40 ---

40
Specs & Handoffs
â€¢ Specs:docs/specs/ (./specs/)
â€¢ Handoffs:docs/handoff/ (./handoff/)
â€¢ Changelog:docs/CHANGELOG.md (./CHANGELOG.md)
CI/CD
â€¢ CI Workflows:.github/workflows/ (./.github/workflows/)
â€¢ GitHub Actions:View in GitHub (https://github.com/ancientagent/UPRISE_NEXT/actions)
Key Contacts
Project Roles:
- Product Owner: (TBD)
- Technical Lead: (TBD)
- DevOps: (TBD)
For Questions:
- Open an issue in GitHub
- Check existing documentation in docs/
- Review specs in docs/specs/
Troubleshooting Tips
Database Issues
# Reset database
cd apps/api
pnpm prisma migrate reset
# Verify PostGIS
psql uprise -c "SELECT PostGIS_version();"
# Check connection
curl http://localhost:4000/api/health/postgis
Port Conflicts
# Kill process on port
lsof -ti:3000 | xargs kill -9 # Web
lsof -ti:4000 | xargs kill -9 # API
lsof -ti:4001 | xargs kill -9 # Socket
Web-Tier Violations
# Run policy check
pnpm run infra-policy-check
# Check web-tier boundary doc
cat apps/web/WEB_TIER_BOUNDARY.md

--- Page 41 ---

41
CI Failures
# Run all CI checks locally
pnpm run lint
pnpm run typecheck
pnpm run test
pnpm run build
pnpm run infra-policy-check
Dependency Issues
# Clear cache and reinstall
pnpm clean
rm -rf node_modules
pnpm install
# Regenerate Prisma Client
cd apps/api
pnpm prisma generate
Environment Variables Quick Reference
apps/api/.env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/uprise"
JWT_SECRET="your-jwt-secret"
PORT=4000
NODE_ENV=development
apps/socket/.env
JWT_SECRET="your-jwt-secret" # Must match API
PORT=4001
NODE_ENV=development
apps/web/.env.local
NEXT_PUBLIC_API_URL=http://localhost:4000
NEXT_PUBLIC_SOCKET_URL=http://localhost:4001
ğŸ‰ Youâ€™re Ready!
You now have everything you need to start contributing to UPRISE_NEXT. Hereâ€™s your action plan:
Next Steps
1. Set up your environment (Section 4)
- Clone the repo
- Install dependencies
- Start PostgreSQL + PostGIS
- Run migrations
- Verify setup with pnpm dev

--- Page 42 ---

42
2. Read the essential docs
- docs/RUNBOOK.md â€” Operational manual
- docs/FEATURE_DRIFT_GUARDRAILS.md â€” Zero-drift policy
- docs/PROJECT_STRUCTURE.md â€” Conventions
- apps/web/WEB_TIER_BOUNDARY.md â€” Web-tier contract (if working on web)
3. Find your task
- Check docs/specs/ for feature specs
- Review docs/handoff/handoff-phase-1.md for current status
- Understand the spec before coding
4. Create your branch
bash
git checkout -b feat/your-feature-name
5. Implement with discipline
- Follow the spec (zero-drift policy)
- Respect architectural boundaries
- Write tests
- Update documentation
6. Validate locally
bash
pnpm run lint
pnpm run typecheck
pnpm run test
pnpm run build
pnpm run infra-policy-check
7. Create handoff document
- Copy docs/handoff/TEMPLATE_agent-handoff.md
- Document decisions, challenges, recommendations
8. Submit PR
- Include deployment target, phase, specs
- Update CHANGELOG.md
- Wait for CI to pass
- Address review feedback
Questions or Issues?
â€¢ Documentation: Check docs/ first
â€¢ Technical Questions: Open an issue in GitHub
â€¢ CI/CD Issues: Review docs/RUNBOOK.md
â€¢ Architecture Questions: Read docs/architecture/UPRISE_OVERVIEW.md
Welcome to UPRISE! Letâ€™s build something amazing together. ğŸµ
